# В разработке

# 3. Инициализация python-oracledb

По умолчанию python-oracledb работает в режиме тонкого клиента, который подключается напрямую к Oracle Database. В этом режиме клиентские библиотеки Oracle не требуются. Однако при их использовании доступны некоторые дополнительные функции . Python-oracledb работает в «толстом» режиме, когда используются клиентские библиотеки Oracle. Оба режима обладают полной функциональностью, поддерживающей спецификацию Python Database API v2.0.

Большинство приложений могут использовать тонкий режим python-oracledb. Наиболее распространённые причины использования толстого режима:

- Ваша база данных Oracle — версия 11 или более поздняя.
- Для подключения к базе данных требуется собственное сетевое шифрование (NNE) или контрольная сумма.
- Вы хотите использовать Application Continuity (AC) или Transparent Application Continuity (TAC)

Все соединения в приложении используют один и тот же режим. Чтобы узнать, какой режим используется, см. раздел «Определение режима python-oracledb» .

Если вы обновляете устаревший драйвер cx_Oracle до python-oracledb, обратитесь к разделу Обновление с cx_Oracle 8.3 до python-oracledb для получения информации об изменениях, которые могут потребоваться.

## 3.1. Включение толстого режима python-oracledb

Чтобы изменить режим `python-oracledb` по умолчанию с тонкого на толстый:

Для обеспечения связи с базой данных должны быть доступны клиентские библиотеки Oracle. Их необходимо установить отдельно, см. раздел Установка python-oracledb .

Можно использовать одну из следующих клиентских библиотек Oracle:

Пакет Oracle Instant Client Basic или Basic Light. Это, как правило, самый простой вариант, если у вас ещё не установлено программное обеспечение Oracle.

Полная установка Oracle Client (устанавливается путем запуска установщика Oracle Universal runInstaller)

Установка Oracle Database, если Python работает на той же машине, что и база данных

Версия клиентской библиотеки не всегда должна совпадать с версией Oracle Database.

Ваше приложение должно вызвать функцию oracledb.init_oracle_client()для загрузки клиентских библиотек. Например, если библиотеки Oracle Instant Client установлены C:\oracle\instantclient_23_5в Windows или $HOME/Downloads/instantclient_23_3macOS, вы можете использовать:

```
import os
import platform

import oracledb

d = None                               # On Linux, no directory should be passed
if platform.system() == "Darwin":      # macOS
  d = os.environ.get("HOME")+("/Downloads/instantclient_23_3")
elif platform.system() == "Windows":   # Windows
  d = r"C:\oracle\instantclient_23_5"
oracledb.init_oracle_client(lib_dir=d)
```

Использование r-строки `r"..."` в Windows означает, что обратный слеш рассматривается как разделитель каталогов. В Linux библиотеки должны быть указаны в системном пути поиска библиотек до запуска процесса Python, предпочтительно настроенном с помощью `ldconfig`.

Более подробная информация и параметры показаны в последующих разделах:

- [Включение толстого режима python-oracledb в Windows](odb_03.md)

- [Включение режима python-oracledb Thick Mode в macOS](odb_03.md)

- [Включение толстого режима python-oracledb в Linux и связанных платформах](odb_03.md)

#### Примечания по вызову init_oracle_client()

- Функцию `init_oracle_client()` необходимо вызвать до создания любого отдельного соединения или пула соединений. Если соединение или пул уже созданы, режим Thick включить невозможно.

- При вызове `init_oracle_client()` с `lib_dir` параметром клиентские библиотеки Oracle загружаются из этого каталога. Если же вы вызываете функцию `init_oracle_client()`, но не задаёте `lib_dir` параметр, клиентские библиотеки Oracle загружаются с использованием эвристики поиска, обсуждаемой в следующих разделах. Обратите внимание, что при установке `lib_dir` в Linux и смежных платформах необходимо настроить системный путь поиска библиотек, включив этот каталог, перед запуском Python.

- После включения Thick-режима вернуться в тонкий режим можно только удалив вызовы `init_oracle_client()` и перезапустив приложение.

- Если клиентские библиотеки Oracle не могут быть загружены, то при вызове `init_oracle_client()` возникнет ошибка. Чтобы устранить эту проблему, ознакомьтесь с инструкциями для конкретной платформы ниже или см. [DPI-1047](odb_28.md): Oracle Client library cannot be loaded init_oracle_client(). В качестве альтернативы, удалите вызов `init_oracle_client()` и используйте режим Thin. Функции, поддерживаемые режимом Thin, можно найти в Приложении A: Функции базы данных Oracle, поддерживаемые python-oracledb.

- В любой операционной системе, если вы указываете в качестве `lib_dir` параметра каталог библиотеки полной базы данных или полной клиентской установки (например, при запуске runInstaller), вам потребуется предварительно настроить среду Oracle, например, установив переменную среды `ORACLE_HOME`. В противном случае возникнут ошибки, подобные ORA-1804. Эту и другие переменные среды Oracle следует установить до запуска Python, как показано в разделе Переменные среды Oracle.

- Функция `init_oracle_client()` может вызываться в приложении несколько раз, но всегда должна передавать одни и те же аргументы.

### 3.1.1. Включение режима Thick Mode в Windows

В Windows существуют следующие способы включения Thick режима:

- Передавая `lib_dir` параметр в вызове `init_oracle_client()`, например:

```
import oracledb

oracledb.init_oracle_client(lib_dir=r"C:\instantclient_23_5")
```

Если путь в Windows содержит обратные косые черты, используйте r-строку, например `r"C:\instantclient_23_5"`.

Этот каталог должен содержать библиотеки из распакованного пакета Instant Client «Basic» или «Basic Light». Если вы передаёте каталог библиотек из полной установки клиента или базы данных, например, Oracle Database «XE» Express Edition , вам необходимо предварительно настроить свою среду на использование той же установки программного обеспечения. В противном случае файлы, такие как файлы сообщений, не будут найдены, и возможны конфликты версий библиотек.

- можно вызвать функцию `init_oracle_client()` без передачи `lib_dir` параметра:

```
import oracledb

oracledb.init_oracle_client()
```

В этом случае библиотеки `Oracle Client` сначала ищутся в каталоге, где установлен модуль `python-oracledb`. Этот каталог должен содержать библиотеки из распакованного пакета Instant Client «Basic» или «Basic Light» .

Если библиотеки там не найдены, поиск продолжится в каталогах, указанных в переменной окружения `PATH`.

### 3.1.2. Включение режима Thick Mode в macOS

В macOS следующие способы включения Thick режима:

- Передавая `lib_dir` параметр в вызове `init_oracle_client()`, например:

```
import oracledb

oracledb.init_oracle_client(lib_dir="/Users/your_username/Downloads/instantclient_23_3")
```

Этот каталог должен содержать библиотеки из распакованного пакета Instant Client «Basic» или «Basic Light» .

- можно вызвать функцию `init_oracle_client()` без передачи `lib_dir` параметра:

```
import oracledb

oracledb.init_oracle_client()
```

В этом случае библиотеки Oracle Client сначала ищутся в каталоге, где установлен модуль python-oracledb для режима Thick. Этот каталог должен содержать библиотеки из распакованного пакета Instant Client «Basic» или «Basic Light» или символическую ссылку на основную библиотеку Oracle Client, если Instant Client находится в другом каталоге.

Вы можете найти каталог, содержащий двоичный модуль режима Thick, вызвав командную строку Python, где выполнить `import oracledb`, а затем введя команду `oracledb`. В результате может быть показано следующее: `/Users/yourname/.pyenv/versions/3.9.6/lib/python3.9/site-packages/oracledb/__init__.py`. После этого нужно убедиться, что по найденному пути, например `/Users/yourname/.pyenv/versions/3.9.6/lib/python3.9/site-packages/oracledb`, находится файл `oracledbthick_impl.cpython-39-darwin.so`

```
CLIENT_DIR=~/Downloads/instantclient_23_3
DPY_DIR=~/.pyenv/versions/3.9.6/lib/python3.9/site-packages/oracledb
ln -s $CLIENT_DIR/libclntsh.dylib $DPY_DIR
```

Это можно автоматизировать в Python с помощью:

```
CLIENT_DIR = "~/Downloads/instantclient_23_3"
LIB_NAME = "libclntsh.dylib"

import os
import oracledb

target_dir = oracledb.__path__[0]
os.symlink(os.path.join(CLIENT_DIR, LIB_NAME),
           os.path.join(target_dir, LIB_NAME))
```

Если `python-oracledb` не находит библиотеку Oracle Client в этом каталоге, можно использовать каталоги в системном пути поиска библиотек, например, `~/lib/` и `/usr/local/lib` или в `$DYLD_LIBRARY_PATH`. Эти пути зависят от версии macOS и версии Python. Не стоит указывать путь в `DYLD_LIBRARY_PATH`, т.к. это не гарантирует передачу параметров в python.

Убедитесь, что процесс Python имеет разрешения на доступ к каталогам и файлам для библиотек клиента Oracle.

### 3.1.3 Включение режима python-oracledb Thick Mode в Linux и связанных платформах

В Linux и связанных платформах включите толстый режим, вызвав его `init_oracle_client()` без передачи `lib_dir` параметра.

```
import oracledb

oracledb.init_oracle_client()
```

Поиск библиотек клиента Oracle осуществляется в пути поиска библиотек операционной системы, например `ldconfig`, настроенном с помощью переменной окружения `LD_LIBRARY_PATH`. Это необходимо настроить до запуска процесса Python. Веб-серверы и другие демоны обычно сбрасывают переменные окружения, поэтому предпочтительнее использовать `ldconfig`. На некоторых платформах UNIX вместо `ldconfig` используется аналогичный параметр, специфичный для ОС, например, `LIBPATH`, `SHLIB_PATH` или `LD_LIBRARY_PATH`.

Если библиотеки не найдены в системном пути поиска библиотек, будут использоваться библиотеки из каталога `$ORACLE_HOME/lib`. Обратите внимание, что переменную окружения `ORACLE_HOME` следует задавать только при полной установке базы данных или клиента (например, с помощью установщика Oracle GUI). Её не следует задавать при использовании Oracle Instant Client. Если она используется, `ORACLE_HOME` и другие необходимые переменные окружения Oracle следует задать до запуска Python. См. раздел Переменные окружения Oracle для python-oracledb .

В Linux режим Thick не будет автоматически загружать файлы клиентской библиотеки Oracle из каталога, где находится двоичный модуль python-oracledb. Вместо этого следует использовать один из вышеперечисленных методов.

Убедитесь, что у процесса Python есть разрешения на доступ к каталогам и файлам клиентских библиотек Oracle. Ограничения ОС могут помешать открытию клиентских библиотек Oracle, установленных по небезопасным путям, например, из пользовательского каталога. Возможно, вам потребуется установить клиентские библиотеки Oracle в каталог, например `/opt` , или `/usr/local`.

### 3.1.4. Отслеживание загрузки клиентской библиотеки Oracle

Чтобы отслеживать загрузку клиентских библиотек Oracle, перед запуском Python можно установить переменную окружения `DPI_DEBUG_LEVEL` равной 64. В командной строке Windows это можно сделать с помощью:

```
set DPI_DEBUG_LEVEL=64
```

В Linux и macOS вы можете использовать:

```
export DPI_DEBUG_LEVEL=64
```

При запуске приложения вывод журнала отображается на терминале.

## 3.2. Явное включение тонкого режима python-oracledb (требует редактирования)

В Python-oracledb по умолчанию используется тонкий режим, но его можно изменить на толстый. В случае, если необходимо явно включить тонкий режим, необходимо вызвать метод `oracledb.enable_thin_mode()`, который предотвратит использование толстого режима. Обычно не потребуется вызывать этот метод.

~~Для обеспечения переносимости приложений внутренняя логика драйвера позволяет приложениям изначально пытаться создать автономное соединение в тонком режиме, а затем, если это соединение не удалось, позволяет им включить толстый режим. Примером может служить попытка подключения к базе данных Oracle Database, которая оказывается старой версией, требующей толстый режим. Эта логика означает, что тонкий режим не применяется принудительно до успешного установления первого соединения. Поскольку все соединения должны быть в одном режиме, любая вторая и последующие параллельные попытки подключения в тонком режиме будут ожидать успешного установления первого автономного соединения. Это означает, что режим драйвера больше не может быть потенциально переключен в толстый режим, что позволяет устанавливать дополнительные соединения в тонком режиме.~~

Если у вас несколько потоков одновременно создают отдельные соединения в тонком режиме, вы можете вызвать метод `oracledb.enable_thin_mode()` в процессе инициализации приложения. Это не обязательно, но позволяет избежать задержки определения режима.

Задержка определения режима не влияет на следующие случаи, поэтому для них вызов `enable_thin_mode()` не требуется:

- Однопоточные приложения, использующие автономные соединения.

- Одно- или многопоточные приложения, использующие пулы соединений (даже при min 0).

Задержка также не повлияет на приложения, которые уже вызвали oracledb.init_oracle_client()включение «Толстого» режима.

Чтобы явно включить тонкий режим, вызовите `enable_thin_mode()`, например:

```
import oracledb

oracledb.enable_thin_mode()
```

После вызова этого метода включить режим Thick для python-oracledb невозможно. При вызове метода `oracledb.init_oracle_client()` вы получите следующую ошибку:

```
DPY-2019: python-oracledb thick mode cannot be used because thin mode has
already been enabled or a thin mode connection has already been created
```

Если вы уже включили толстый режим, вызвав `oracledb.init_oracle_client()`, а затем вызвав `oracledb.enable_thin_mode()`, вы получите следующую ошибку:

```
DPY-2053: python-oracledb thin mode cannot be used because thick mode has
already been enabled
```

## 3.3. Дополнительные файлы конфигурации Oracle

### 3.3.1. Дополнительные файлы конфигурации Oracle Net

При подключении или создании пулов соединений могут быть прочитаны дополнительные файлы конфигурации Oracle Net. Эти файлы влияют на поведение соединения. Наиболее распространённые файлы:

 - `tnsnames.ora`: файл конфигурации, определяющий псевдонимы баз данных и связанную с ними информацию о конфигурации подключения, используемую для установки соединений. См. раздел Псевдонимы TNS для строк подключения .

 - `sqlnet.ora`: файл конфигурации, содержащий настройки таких функций, как отказоустойчивое подключение, сетевое шифрование, ведение журнала и трассировка. Этот файл используется только в режиме Thick. В режиме Thin многие настройки можно определить как параметры времени подключения.

Чтобы понять, как `python-oracledb` находит файлы, ознакомьтесь с разделом Использование дополнительных файлов конфигурации Oracle .

### 3.3.2 Дополнительный файл конфигурации клиента Oracle

Если в режиме Thick используются клиентские библиотеки Oracle версии 12.1 или более поздней, для настройки некоторых функций этих библиотек, таких как кэширование операторов и предварительная выборка, можно использовать дополнительный файл клиентских параметров, называемый `oraaccess.xml`. Это может быть полезно для изменения поведения приложения, если его код невозможно изменить.

Пример файла, который задает значение предварительной выборки клиента Oracle в 1000 строк для каждого запроса в приложении:

```
<?xml version="1.0"?>
 <oraaccess xmlns="http://xmlns.oracle.com/oci/oraaccess"
  xmlns:oci="http://xmlns.oracle.com/oci/oraaccess"
  schemaLocation="http://xmlns.oracle.com/oci/oraaccess
  http://xmlns.oracle.com/oci/oraaccess.xsd">
  <default_parameters>
    <prefetch>
      <rows>1000</rows>
    </prefetch>
  </default_parameters>
</oraaccess>
```

Файл `oraaccess.xml` имеет и другие применения, в том числе:

- Изменение значения событий FAN быстрого уведомления приложений , которое влияет на уведомления и балансировку нагрузки во время выполнения (RLB).

- Настройка параметров кэширования результатов клиента.

- Включение Client Statement Cache Auto-tuning. 

Более подробную информацию см. в документации по `oraaccess.xml`.

Чтобы понять, как python-oracledb находит файл, ознакомьтесь с разделом Использование дополнительных файлов конфигурации Oracle .

Другой способ настройки некоторых параметров поведения python-oracledb без изменения кода приложения см. в разделе Параметры Python-oracledb, устанавливаемые в строках Easy Connect или поставщиках централизованной конфигурации.

### 3.3.3 Использование дополнительных файлов конфигурации Oracle

Если вы используете дополнительные файлы конфигурации Oracle, такие как `tnsnames.ora`, `sqlnet.ora`, или `oraaccess.xml` для настройки подключений, поместите файлы в каталог, доступный для python, и следуйте инструкциям ниже.

Обратите внимание, что синтаксис Easy Connect позволяет задавать множество общих параметров конфигурации без необходимости использования файлов `tnsnames.ora`, `sqlnet.ora`, или `oraaccess.xml`.

#### Поиск tnsnames.ora в режиме Thin

Python-oracledb будет читать файл `tnsnames.ora`, если для `dsn` параметра `oracledb.connect()`, `oracledb.create_pool()`, `oracledb.connect_async()` или `oracledb.create_pool_async()` указан псевдоним TNS. Будет прочитан только файл `tnsnames.ora`. Если псевдоним TNS в этом файле не найден, подключение будет прервано. В Thin режиме не читаются другие файлы конфигурации, такие как `sqlnet.ora`, `oraaccess.xml`.

В режиме Thin необходимо явно указать каталог, поскольку некоторые традиционные расположения «по умолчанию», такие как `$ORACLE_BASE/homes/XYZ/network/admin/` (в домашнем каталоге Oracle Database, доступном только для чтения) или реестр Windows, автоматически не используются.

Каталог, используемый для поиска `tnsnames.ora`, определяется следующим образом (используется первый найденный):

- значение параметра `config_dir` в методе `connect`

```
connection = oracledb.connect(user="hr", password=userpwd, dsn="orclpdb",
                              config_dir="/opt/oracle/config")
```

- значение параметра `params` в атрибуте метода `config_dir`

```
params = oracledb.ConnectParams(config_dir="/opt/oracle/config")
connection = oracledb.connect(user="hr", password=userpwd, dsn="orclpdb", params=params)
```

- значение `oracledb.defaults.config_dir`, которое могло быть явно задано для каталога или установлено внутренне во время инициализации как `$TNS_ADMIN` или `$ORACLE_HOME/network/admin`.

```
oracledb.defaults.config_dir = "/opt/oracle/config"
connection = oracledb.connect(user="hr", password=userpwd, dsn="orclpdb")
```

Этот порядок также применяется к режиму Thick, когда `oracledb.defaults.thick_mode_dsn_passthrough` равен False.

#### Поиск tnsnames.ora, sqlnet.ora или oraaccess.xml в режиме python-oracledb Thick

В режиме Thick можно явно указать каталог, содержащий необязательные файлы конфигурации клиента Oracle, такие как `tnsnames.ora`, `sqlnet.ora`, и `oraaccess.xml`, в противном случае библиотеки клиента Oracle будут использовать эвристический метод для поиска каталога.

Если `oracledb.defaults.thick_mode_dsn_passthrough = False`, то следующее применяется ко всем файлам, кроме `tnsnames.ora`.

Каталог файла конфигурации определяется следующим образом:

- Из параметра `config_dir` в `oracledb.init_oracle_client()`:

```
oracledb.init_oracle_client(config_dir="/opt/oracle/config")
```

В Windows, если путь содержит обратные косые черты, используйте r-строку, например `r"C:\instantclient_23_5"`.

- Если `init_oracle_client()` вызывается для включения режима Thick, но `config_dir` не указано, то поиск файлов конфигурации выполняется в каталогах по умолчанию. Это зависит от платформы и контролируется Oracle Client. Каталоги включают в себя:

    - Ваш домашний каталог, используя `$HOME/.tnsnames.ora` и `$HOME/.sqlnet.ora`

    - Каталог `/var/opt/oracle` на Solaris и `/etc` на других платформах UNIX.

    - Каталог, указанный переменной среды `TNS_ADMIN`.

    - Для ZIP-файлов Oracle Instant Client это `network/admin` подкаталог Instant Client, например `/opt/oracle/instantclient_23_5/network/admin`.

    - Для RPM-пакетов Oracle Instant Client это `network/admin` подкаталог Instant Client, например `/usr/lib/oracle/23.5/client64/lib/network/admin`.

    - При использовании библиотек из локальной базы данных Oracle или полной клиентской установки в `$ORACLE_HOME/network/admin` или `$ORACLE_BASE_HOME/network/admin`.

В Windows при полной установке базы данных Oracle Client также может обращаться к реестру Windows.

Дополнительные сведения о пути поиска см. в справочнике Oracle Net Services .

В документации Network Configuration содержится дополнительная информация о некоторых конкретных конфигурациях Oracle Net, полезных для приложений.

#### Настройка thick_mode_dsn_passthrough

Если параметр `oracledb.defaults.thick_mode_dsn_passthrough` установлен в значение `True`, клиентские библиотеки Oracle находят и считывают любые дополнительные `tnsnames.ora` настройки. Это всегда было поведением режима Thick в python-oracledb в версиях до 3.0 и является значением по умолчанию в python-oracledb 3.0 и более поздних.

Установка параметра `oracledb.defaults.thick_mode_dsn_passthrough` в значение `False` заставляет толстый режим использовать ту же эвристику, что и тонкий режим, в отношении обработки параметров строки подключения и чтения любого необязательного tnsnames.ora файла конфигурации.

Такие файлы, как `sqlnet.ora` и `oraaccess.xml` используются только в режиме Thick. Они всегда находятся и считываются клиентскими библиотеками Oracle независимо от значения `oracledb.defaults.thick_mode_dsn_passthrough`. Эвристика поиска в каталоге определяется клиентскими библиотеками Oracle в момент вызова `oracledb.init_oracle_client()`, как показано выше.

Значение `oracledb.defaults.thick_mode_dsn_passthrough` игнорируется в тонком режиме.

## 3.4. Переменные среды Oracle для python-oracledb

Ниже приведены некоторые распространённые переменные окружения, влияющие на python-oracledb. Необходимые переменные зависят от того, как установлен Python, как вы подключаетесь к базе данных и какие дополнительные параметры требуются. Рекомендуется задать переменные Oracle в окружении до вызова Python. Однако их также можно задать в приложении при помощи `os.putenv()` до установки первого соединения.

> ### Примечание
> Системные переменные среды, такие как `LD_LIBRARY_PATH`, должны быть установлены перед запуском Python.

Перечисленные ниже общие переменные среды поддерживаются в python-oracledb.

Таблица 3.1 Общие переменные среды Oracle, поддерживаемые python-oracledb

| Переменная среды Oracle | Цель | Режим Python-oracledb|
|-------------------------|------|----------------------|
| LD_LIBRARY_PATH | Путь поиска библиотек для таких платформ, как Linux, должен включать, например, библиотеки Oracle, например `$ORACLE_HOME/lib` или `/opt/instantclient_23_5`. Эта переменная не нужна, если библиотеки находятся альтернативным способом, например, с помощью `ldconfig`. На других платформах UNIX может потребоваться установить эквивалент, специфичный для ОС, например `LIBPATH`, или `SHLIB_PATH`. | Толстый |
| NLS_DATE_FORMAT, NLS_TIMESTAMP_FORMAT | Часто устанавливается в приложениях Python для принудительного использования единого формата даты независимо от локали. Эти переменные игнорируются, если переменная окружения `NLS_LANG` не установлена.  | Толстый |
| NLS_LANG | Определяет параметры глобализации «поддержка национального языка» для python-oracledb. Обратите внимание, что компонент набора символов игнорируется, `NLS_LANG` используются только компоненты языка и территории. Набор символов можно указать при создании соединения или пула соединений. См. раздел Наборы символов и глобализация . | Толстый |
| ORA_SDTZ | Часовой пояс сеанса по умолчанию. | Оба |
| ORA_TZFILE | Имя файла часового пояса Oracle, который будет использоваться. См. Файлы часовых поясов . | Толстый |
| ORACLE_HOME | Каталог, содержащий программное обеспечение Oracle Database. Каталог и различные файлы конфигурации должны быть доступны для чтения процессом Python. Эту переменную не следует устанавливать, если вы используете Oracle Instant Client. | Толстый |
| PATH | Путь поиска библиотеки для Windows должен включать местоположение, где находится `OCI.DLL`. Эта переменная не нужна, если вы задаете `lib_dir` при вызове `oracledb.init_oracle_client()`. | Толстый |
| TNS_ADMIN | Каталог дополнительных файлов конфигурации клиента Oracle, таких как `tnsnames.ora` и `sqlnet.ora`. Обычно не требуется, если файлы конфигурации находятся в расположении по умолчанию или `config_dir` не использовались в `oracledb.init_oracle_client()`. См. раздел Дополнительные файлы конфигурации Oracle Net | Оба |

## 3.5. Другие варианты инициализации толстого режима python-oracledb

Функция `oracledb.init_oracle_client()` позволяет задавать параметры `driver_name` и `error_url`. Это полезно для приложений, конечные пользователи которых не знают об использовании python-oracledb. Пример настройки параметров:

```
oracledb.init_oracle_client(driver_name="My Great App : 3.1.4",
                            error_url="https://example.com/MyInstallInstructions.html")
```

По соглашению `driver_name` название продукта и его версия должны быть отделены двоеточием и одним пробелом. Значение будет отображаться в представлениях Oracle Database как `V$SESSION_CONNECT_INFO`. Если этот параметр не указан, будет использоваться значение, указанное в атрибуте `oracledb.defaults.driver_name`. Если значение этого атрибута равно `None`, будет отображаться значение, подобное этому `python-oracledb thk : 3.0.0`, см. раздел «Нахождение режима python-oracledb».

Эта `error_url` строка будет отображаться в исключении, возникающем при вызове `init_oracle_client()` и невозможности загрузить клиентские библиотеки Oracle. Это позволяет приложениям, использующим python-oracledb в режиме Thick, направлять пользователей к инструкциям по установке для конкретного приложения. Если это значение не указано, используется URL-адрес для установки python-oracledb .

## 3.6. Переход из толстого режима python-oracledb в тонкий режим python-oracledb

Для изменения приложения, использующего толстый режим , на тонкий режим потребуется удалить вызовы `oracledb.init_oracle_client()` и перезапустить приложение. Могут потребоваться и другие небольшие изменения:

1. Удалить все вызовы `oracledb.init_oracle_client()` из приложения.

2. Просмотрите Приложение A: Функции базы данных Oracle, поддерживаемые python-oracledb и Приложение B: Различия между тонким и толстым режимами python-oracledb для внесения необходимых изменений в код.

3. Перезапустите приложение.

4. Протестируйте и проверьте поведение вашего приложения.

Если вас всё устраивает, вы можете при желании удалить библиотеки Oracle Client. Например, удалите каталог Oracle Instant Client.

Вы можете проверить режим python-oracledb, проверив `Connection.thin`, `ConnectionPool.thin` или выполнив запрос к столбцу `CLIENT_DRIVER` таблицы `V$SESSION_CONNECT_INFO` и проверив, начинается ли значение столбца с текста `python-oracledb thn`. См. раздел Определение режима python-oracledb.

> Обратите внимание, что все соединения в приложении python-oracledb должны использовать один и тот же режим.

## 3.7. Изменение настроек python-oracledb по умолчанию

В Python-oracledb есть одноэлементный объект Defaults с атрибутами, определяющими поведение драйвера по умолчанию. Доступ к объекту осуществляется через defaultsатрибут импортированного драйвера.

Например, чтобы вернуть запрошенные столбцы LOB непосредственно в виде строк или байтов:

import oracledb

oracledb.defaults.fetch_lobs = False
Информацию об атрибутах, которые можно задать, см. в разделе Атрибуты по умолчанию .
